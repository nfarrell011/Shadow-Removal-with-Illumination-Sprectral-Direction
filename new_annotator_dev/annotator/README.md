## Image Annotator

This program will allows a user to annotate images and processes the images in real-time into log chromaticity space.

The program computes a localized ISD based on the weighted mean of the ISDs computed at each annotation location. Weights are determined by the distance from each pixel to the center of the line connecting the lit and shadow pairs.

The program does NOT save a processed image.

Rather, the program saves an ISD map for each processed image stored as a ```png```. The results can regenerated by processing images using the saved ISD map.

Prior the saving the ISD map, values are multiplied by 255.

To use the ISD maps downstream, divide the resultant ISD maps by 255 and map to a float.

### Usage Instructions:
### ```Step 1```
Clone the repo or download the following files:
* ```annotator_class.py```
* ```image_processor_class.py```
* ```annotator_driver.py ```


### ```Step 2```
Add the image folder (images to be processed) to the directory containing the image annotator folder (the files in this repo).
```
base_directory/
├── image_folder_1
├── image_folder_2
├── image_annotator/
│       ├── annotator_class.py
│       ├── image_processor_class.py
│       └── annotator_driver.py.csv
```
Setting the file structure in this way allows for current pathing implementation to execute. Alternatively, the pathing setup can be modified in ```annotator.py``` to the user specifications.

### ```Step 3```
Update ```image_folder``` variable assignment in ```annotator_driver.py``` to the name of the image folder, i.e., ```folder_1```, ```folder_2```, etc.

```python
# UPDATE THIS: This is name of the folder that contains the images to be processed
image_folder = 'test' # Change 'test' to your folder name!
```

### ```Step 4```
Execute ```annotator_driver.py``` 

This GUI will appear:

<img src="readme_figs/step_1.png" alt="Alt text" title="Optional Title" width="600">


### ```Step 5```
Annotate the image.

**Functionality**
* ***Clicks***
  * ```left click:``` Adds an annotation.
  * ```right click``` Remove a single annotation.
* ***Key strokes***
  * ```r``` Start over; removes all annotations.

**Important Notes:**
1. Make annotations in the following order:
   1. Lit region
   2. Shadow region
2. Each annotation pair should be on the same material!!!!

Annotations will be displayed on the original image as they are made. The green circles are the lit annotations and red circles are the dark annotations.

<img src="readme_figs/one_annotation.png" alt="Alt text" title="Optional Title" width="600">

The program will automatically process the image.

___ 

<img src="readme_figs/patch_size.png" alt="Alt text" title="Optional Title" width="600">

Adjust the patch size and anchor point with the trackbars in this window. Patch size will modify the computation of the ISD and often improves performance.  

Adjusting anchor point does NOT actually change the ISD computation, but allows the user to inspect results.
___ 
Add annotations, adjusting patch size and anchor point until satisfied with results.

<img src="readme_figs/2_annotations.png" alt="Alt text" title="Optional Title" width="600">

### ```Step 6```
Assign the image to destinaion folder with key strokes.

***Key Strokes***
* ```h```: Excellent results.
* ```l```: Low quality results.
* ```t```: Terrible results; the input image is of low quality
* ```d```: Duplicate image.

### ```Results```

The program will create directories and files to store the results. Processing an image folder will result in the following file/folder structure.


```
base_directory/
├── image_folder_1
│       ├── processed/
│           ├── bad_images/
│           ├── duplicates/
│           ├── high_quality/
│           ├── image_error/
│           ├── isd_maps/
│           └── annotator_driver.py.csv
│       ├── annotations_csv.csv
│       └── annotations.xml
├── image_annotator/
│       ├── annotator_class.py
│       ├── image_processor_class.py
│       └── annotator_driver.py.csv
```

**Files**
```annotations_csv.csv```: Contains the image file name and the annotation coordinates for all images; high quality, low quality, terrible, and duplicate.
```annotations.xml```:  Contains the image file name, annotation coordinates, patch size, and anchor point for all images; high quality, low quality, terrible, and duplicate..  
**Folders**
```bad_images```: Contains the images designated terrible, low quality input.
```duplicate```: Contains the images designated duplicate.
```high_quality```: Contains the images designated high quality.
```low_quality```: Contains the images designated low quality.
```isd_map```: Contains an ISD maps for all the images processed stored as a png. To use the ISD map downstream, divide it by 255.0 and map to a float.




